{% extends "base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto p-8 bg-gray-800 rounded-2xl shadow-2xl">
  <h1 class="text-3xl font-bold mb-8 text-center flex items-center justify-center gap-2">
    <i data-lucide="calculator"></i> Cotizar Reparación
  </h1>

  <!-- FLEX para Formulario y Resultado LADO A LADO -->
  <div class="flex flex-col md:flex-row gap-8">
    <!-- Formulario -->
    <div class="md:w-1/2 space-y-6">
      <form id="formularioCotizar" class="space-y-6">
        <div>
          <label for="precioRepuesto" class="block mb-2">Precio del Repuesto ($)</label>
          <input type="number" id="precioRepuesto" name="precioRepuesto" required class="w-full p-3 rounded bg-gray-700 border border-gray-600" placeholder="Ej: 20000">
        </div>

        <div>
          <label for="cuotas" class="block mb-2">Elegir forma de pago</label>
          <select id="cuotas" name="cuotas" required class="w-full p-3 rounded bg-gray-700 border border-gray-600">
            <option value="efectivo">Efectivo</option>
            <option value="3">3 cuotas</option>
            <option value="6">6 cuotas</option>
          </select>
        </div>

        <button type="button" onclick="calcular()" class="w-full flex items-center justify-center gap-2 p-3 bg-primary-600 hover:bg-primary-700 rounded font-bold">
          <i data-lucide="check-circle"></i> Calcular
        </button>
      </form>
    </div>

    <!-- Resultado -->
    <div id="resultado" class="md:w-1/2 hidden text-center md:text-left space-y-4 bg-gray-700 p-6 rounded-lg">
      <h2 class="text-2xl font-bold flex items-center gap-2 mb-4 justify-center md:justify-start">
        <i data-lucide="badge-dollar-sign"></i> Resultado
      </h2>
      <p id="totalCobrar" class="text-lg font-bold"></p>
      <p id="valorCuota" class="text-lg font-semibold"></p>
      <p id="cantidadCuotas" class="text-lg font-semibold"></p>
      <p id="descuentoEfectivo" class="text-lg font-bold text-green-400 flex items-center gap-2 justify-center md:justify-start"></p>
    </div>
  </div>
</div>

<script>
function calcular() {
  const precioRepuesto = parseFloat(document.getElementById('precioRepuesto').value);
  const cuotas = document.getElementById('cuotas').value;

  if (isNaN(precioRepuesto)) {
    alert("Por favor, ingresá el precio del repuesto.");
    return;
  }

  // Precio efectivo base (repuesto + 5000) * 2
  let precioEfectivo = (precioRepuesto + 5000) * 2;
  let mensaje = "";
  
  if (cuotas === "efectivo") {
    mensaje = `<i data-lucide="hand-coins"></i> <strong>Precio final en efectivo:</strong> $${precioEfectivo.toFixed(2)}`;
    document.getElementById('valorCuota').innerHTML = "";
    document.getElementById('cantidadCuotas').innerHTML = "";
    document.getElementById('descuentoEfectivo').innerHTML = "";
  } 
  else if (cuotas === "3") {
    let precioConRecargo = precioEfectivo * 1.25;
    const valorPorCuota = precioConRecargo / 3;

    mensaje = `<i data-lucide="credit-card"></i> <strong>Total con 25% de recargo:</strong> $${precioConRecargo.toFixed(2)}`;
    document.getElementById('valorCuota').innerHTML = `<strong>Valor por cuota:</strong> $${valorPorCuota.toFixed(2)}`;
    document.getElementById('cantidadCuotas').innerHTML = `<strong>Cantidad de cuotas:</strong> 3`;
    document.getElementById('descuentoEfectivo').innerHTML = `<i data-lucide="ticket-percent"></i> <strong>Promo pago contado:</strong> $${precioEfectivo.toFixed(2)}`;
  } 
  else if (cuotas === "6") {
    let precioConRecargo = precioEfectivo * 1.40;
    const valorPorCuota = precioConRecargo / 6;
    mensaje = `<i data-lucide="credit-card"></i> <strong>Total con 40% de recargo:</strong> $${precioConRecargo.toFixed(2)}`;
    document.getElementById('valorCuota').innerHTML = `<strong>Valor por cuota:</strong> $${valorPorCuota.toFixed(2)}`;
    document.getElementById('cantidadCuotas').innerHTML = `<strong>Cantidad de cuotas:</strong> 6`;
    document.getElementById('descuentoEfectivo').innerHTML = "";
  }

  document.getElementById('totalCobrar').innerHTML = mensaje;
  document.getElementById('resultado').classList.remove('hidden');
  lucide.createIcons(); // Recargar iconos
}
</script>
{% endblock %}
